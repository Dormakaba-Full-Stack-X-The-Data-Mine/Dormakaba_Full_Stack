<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dormakaba X The Data Mine</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/inter-ui/3.19.3/inter.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Dormakaba X The Data Mine</h1>
        
        <!-- Upload Section -->
        <div class="upload-section">
            <h2>Bulk Upload</h2>
            <div class="file-upload">
                <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls" class="file-input">
                <label for="fileUpload" class="file-label">
                    <span class="file-text">Choose a file or drag it here</span>
                    <span class="file-button">Browse Files</span>
                </label>
            </div>
            <div id="uploadMessage" class="message"></div>
        </div>

        <!-- Single Entry Form -->
        <form id="hotelForm" class="hotel-form">
            <h2>Single Entry Form</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="customerAccount">Customer Account Number*</label>
                    <input type="text" id="customerAccount" required>
                </div>

                <div class="form-group">
                    <label for="sapS8">SAP S8*</label>
                    <input type="text" id="sapS8" required>
                </div>

                <div class="form-group">
                    <label for="hotelInnCode">Hotel Inn Code</label>
                    <input type="text" id="hotelInnCode">
                </div>

                <div class="form-group">
                    <label for="marshaCode">Marsha Code</label>
                    <input type="text" id="marshaCode">
                </div>

                <div class="form-group">
                    <label for="starlinkCode">Starlink Code</label>
                    <input type="text" id="starlinkCode">
                </div>

                <div class="form-group">
                    <label>Vacation Rental</label>
                    <div class="radio-group">
                        <label class="radio">
                            <input type="radio" name="vacationRental" value="no" checked>
                            <span>No</span>
                        </label>
                        <label class="radio">
                            <input type="radio" name="vacationRental" value="yes">
                            <span>Yes</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="tradeName">Trade Name</label>
                    <input type="text" id="tradeName">
                </div>

                <div class="form-group">
                    <label for="hotelChain">Hotel Chain*</label>
                    <input type="text" id="hotelChain" required>
                </div>

                <div class="form-group">
                    <label for="affiliation">Affiliation</label>
                    <input type="text" id="affiliation">
                </div>

                <div class="form-group">
                    <label for="country">Country*</label>
                    <select id="country" required>
                        <option value="">Select a country</option>
                        <option value="United States">United States</option>
                        <option value="Canada">Canada</option>
                    </select>
                </div>

                <div class="form-group address-group">
                    <label for="address">Address*</label>
                    <input type="text" id="streetNumber" placeholder="Street Number">
                    <input type="text" id="streetName" placeholder="Street Name">
                    <input type="text" id="zipCode" placeholder="ZIP Code">
                </div>
            </div>

            <div class="button-group">
                <button type="submit" class="primary">Submit Entry</button>
                <button type="button" id="exportCsv" class="secondary">Export CSV</button>
                <button type="button" id="generateGraphs" class="secondary">Generate Graphs</button>
            </div>
        </form>

        <div id="formMessage" class="message"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // File upload handling
            const fileUpload = document.getElementById('fileUpload');
            const uploadMessage = document.getElementById('uploadMessage');

            fileUpload.addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/upload-bulk', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    
                    uploadMessage.textContent = result.message;
                    uploadMessage.className = `message ${result.success ? 'success' : 'error'} show`;
                } catch (error) {
                    uploadMessage.textContent = 'Error uploading file';
                    uploadMessage.className = 'message error show';
                }
            });

            // Form submission handling
            const hotelForm = document.getElementById('hotelForm');
            const formMessage = document.getElementById('formMessage');

            hotelForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const formData = {
                    customer_account: document.getElementById('customerAccount').value,
                    sap_s8: document.getElementById('sapS8').value,
                    hotel_inn_code: document.getElementById('hotelInnCode').value,
                    marsha_code: document.getElementById('marshaCode').value,
                    starlink_code: document.getElementById('starlinkCode').value,
                    vacation_rental: document.querySelector('input[name="vacationRental"]:checked').value,
                    trade_name: document.getElementById('tradeName').value,
                    hotel_chain: document.getElementById('hotelChain').value,
                    affiliation: document.getElementById('affiliation').value,
                    country: document.getElementById('country').value,
                    street_number: document.getElementById('streetNumber').value,
                    street_name: document.getElementById('streetName').value,
                    zip_code: document.getElementById('zipCode').value
                };

                try {
                    const response = await fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    const result = await response.json();
                    
                    formMessage.textContent = result.message;
                    formMessage.className = `message ${result.success ? 'success' : 'error'} show`;
                    
                    if (result.success) {
                        hotelForm.reset();
                    }
                } catch (error) {
                    formMessage.textContent = 'Error submitting form';
                    formMessage.className = 'message error show';
                }
            });

            // Export CSV handling
            document.getElementById('exportCsv').addEventListener('click', function() {
                window.location.href = '/export-csv';
            });
        });
    </script>
</body>
</html>